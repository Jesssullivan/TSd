import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{o as qe,a as ht}from"../chunks/vsKkyAZf.js";import{h as me,ap as _t,aq as bt,ar as mt,$ as Ae,am as K,M as Oe,g as yt,a0 as ne,a1 as We,k as n,F as b,a2 as c,a3 as d,f as Ie,D as te,J as Tt,a4 as f,as as w}from"../chunks/BckHep5H.js";import{s as H,e as k}from"../chunks/DKFbEgCw.js";import{i as V,b as wt}from"../chunks/CstVbTSV.js";import{f as G,a as _,c as De,t as E}from"../chunks/CUK3pkoi.js";import{i as St}from"../chunks/BfUNpN1q.js";import{p as ke}from"../chunks/DySfId5U.js";import{s as Le}from"../chunks/BgcUizg5.js";import{l as ye,s as Et}from"../chunks/D-eAupRb.js";import{g as Fe}from"../chunks/CVz61ZC1.js";const He=[...` 	
\r\f \v\uFEFF`];function Ct(s,e,t){var o=s==null?"":""+s;if(t){for(var a in t)if(t[a])o=o?o+" "+a:a;else if(o.length)for(var r=a.length,l=0;(l=o.indexOf(a,l))>=0;){var v=l+r;(l===0||He.includes(o[l-1]))&&(v===o.length||He.includes(o[v]))?o=(l===0?"":o.substring(0,l))+o.substring(v+1):l=v}}return o===""?null:o}function F(s,e,t,o,a,r){var l=s.__className;if(me||l!==t||l===void 0){var v=Ct(t,o,r);(!me||v!==s.getAttribute("class"))&&(v==null?s.removeAttribute("class"):s.className=v),s.__className=t}else if(r&&a!==r)for(var g in r){var m=!!r[g];(a==null||m!==!!a[g])&&s.classList.toggle(g,m)}return r}const $t=Symbol("is custom element"),Pt=Symbol("is html");function xt(s,e,t,o){var a=Rt(s);me&&(a[e]=s.getAttribute(e)),a[e]!==(a[e]=t)&&(t==null?s.removeAttribute(e):typeof t!="string"&&Ut(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function Rt(s){return s.__attributes??(s.__attributes={[$t]:s.nodeName.includes("-"),[Pt]:s.namespaceURI===_t})}var Ge=new Map;function Ut(s){var e=Ge.get(s.nodeName);if(e)return e;Ge.set(s.nodeName,e=[]);for(var t,o=s,a=Element.prototype;a!==o;){t=mt(o);for(var r in t)t[r].set&&e.push(r);o=bt(o)}return e}var U={},Me=Object.defineProperty,Nt=(s,e,t)=>e in s?Me(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ot=(s,e)=>Me(s,"name",{value:e,configurable:!0}),Ke=(s,e,t)=>Nt(s,typeof e!="symbol"?e+"":e,t);const Te=class Ye{constructor(){Ke(this,"config"),this.config=this.detectEnvironment()}static getInstance(){return this.instance||(this.instance=new Ye),this.instance}detectEnvironment(){if(this.isRunningInKubernetes()){const o=this.discoverEnvoySidecar();if(o)return console.log("[TSd] Detected Envoy sidecar in Kubernetes:",o),{endpoint:o,isEnvoy:!0,environment:"kubernetes",protocol:"grpc-web"}}const t=this.discoverStandaloneEnvoy();return t?(console.log("[TSd] Detected standalone Envoy proxy:",t),{endpoint:t,isEnvoy:!0,environment:"production",protocol:"grpc-web"}):(console.log("[TSd] Running in development mode with HTTP/JSON"),{endpoint:typeof window<"u"?window.location.origin:"http://localhost:3000",isEnvoy:!1,environment:"development",protocol:"http-json"})}isRunningInKubernetes(){if(typeof window<"u"){const e=window.location.hostname;return e.includes(".cluster.local")||e.includes(".svc")||this.hasKubernetesHeaders()}else return!!(U.KUBERNETES_SERVICE_HOST||U.KUBERNETES_PORT||U.KUBERNETES_SERVICE_PORT)}hasKubernetesHeaders(){return!1}discoverEnvoySidecar(){if(typeof process<"u"){const e=U.ENVOY_HOST||U.ENVOY_PROXY_HOST,t=U.ENVOY_PORT||U.ENVOY_PROXY_PORT;if(e&&t)return`http://${e}:${t}`}return typeof window<"u"&&document.querySelector('meta[name="x-envoy-upstream-service-time"]')?`${window.location.protocol}//${window.location.hostname}:15000`:null}discoverStandaloneEnvoy(){const e=["envoy","envoy-proxy","grpc-proxy","api-gateway"];if(typeof window<"u"){const t=window.location.hostname;for(const o of e)if(t.includes(o))return window.location.origin}if(typeof process<"u"){const t=U.GRPC_WEB_PROXY_URL||U.ENVOY_PROXY_URL;if(t)return t}return null}getConfig(){return this.config}setConfig(e){this.config={...this.config,...e},console.log("[TSd] Envoy config updated:",this.config)}};Ot(Te,"EnvoyDiscovery");Ke(Te,"instance");let It=Te;var Ve=Object.defineProperty,Dt=(s,e,t)=>e in s?Ve(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Lt=(s,e)=>Ve(s,"name",{value:e,configurable:!0}),Y=(s,e,t)=>Dt(s,typeof e!="symbol"?e+"":e,t);const je=class{constructor(e){var t,o;if(Y(this,"baseUrl"),Y(this,"subscriptions",new Map),Y(this,"eventSource",null),Y(this,"envoyDiscovery"),Y(this,"requestCount",0),Y(this,"envoyConfig"),this.envoyDiscovery=It.getInstance(),typeof window<"u"&&((o=(t=window.__TSD_CONFIG__)==null?void 0:t.envoy)!=null&&o.endpoint)){const a=window.__TSD_CONFIG__.envoy.endpoint;console.log(`[TSd] 🎯 Using configured Envoy endpoint: ${a}`),this.envoyDiscovery.setConfig({endpoint:a,isEnvoy:!0,environment:"production",protocol:"grpc-web"})}this.envoyConfig=this.envoyDiscovery.getConfig(),this.envoyConfig.isEnvoy?(this.baseUrl=this.envoyConfig.endpoint,console.log(`[TSd] 🚀 Using Envoy proxy at ${this.baseUrl} (${this.envoyConfig.environment} environment)`)):window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.startsWith("192.168.")||window.location.hostname.includes(".local")?(this.baseUrl=`${window.location.origin}/grpc`,console.log(`[TSd] 🌐 Using development gRPC server at ${this.baseUrl}`)):(this.baseUrl=`${window.location.origin}/api`,console.log(`[TSd] 🌐 Using production API at ${this.baseUrl}`)),this.logConnectionInfo()}logConnectionInfo(){console.group("[TSd] Connection Information"),console.log("Protocol:",this.envoyConfig.protocol),console.log("Environment:",this.envoyConfig.environment),console.log("Envoy Detected:",this.envoyConfig.isEnvoy),console.log("Base URL:",this.baseUrl),console.groupEnd()}async translate(e,t,o){const a=++this.requestCount,r=performance.now();console.log(`[TSd] 📤 Request #${a}: Translating "${e}" from ${t} to ${o}`);try{const l={"Content-Type":"application/json"};this.envoyConfig.isEnvoy&&(l["X-Grpc-Web"]="1",l["grpc-timeout"]="10S");let v,g;this.envoyConfig.isEnvoy||this.baseUrl.includes("/grpc")?(v=`${this.baseUrl}/tsd.TranslationService/Translate`,g={text:e,native_locale:t,target_locale:o}):(v=`${this.baseUrl}/translate`,g={text:e,from:t,to:o});const m=await fetch(v,{method:"POST",headers:l,body:JSON.stringify(g)}),x=(performance.now()-r).toFixed(2);if(!m.ok)throw console.error(`[TSd] ❌ Request #${a} failed: HTTP ${m.status} (${x}ms)`),new Error(`HTTP error! status: ${m.status}`);const M=await m.json(),N=M.translated_text||M.translated||e;return console.log(`[TSd] ✅ Request #${a} completed in ${x}ms via ${this.envoyConfig.isEnvoy?"Envoy":this.baseUrl.includes("/grpc")?"gRPC":"API"}`),console.log(`[TSd] 📥 Translation: "${e}" → "${N}"`),N}catch(l){const g=(performance.now()-r).toFixed(2);throw console.error(`[TSd] ❌ Request #${a} error after ${g}ms:`,l),l}}async getTranslations(e){try{const t=await fetch(`${this.baseUrl}/tsd.TranslationService/GetTranslations`,{method:"POST",headers:{"Content-Type":"application/json","X-Grpc-Web":"1"},body:JSON.stringify({locale:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return(await t.json()).translations||{}}catch(t){throw console.error("[TSd gRPC Client] Get translations error:",t),t}}subscribeToUpdates(e,t){const o=Math.random().toString(36).substring(7);this.subscriptions.set(o,e),console.log(`[TSd] 🔔 Setting up real-time updates via ${this.envoyConfig.isEnvoy?"Envoy gRPC streaming":"Server-Sent Events"}`),this.eventSource&&this.eventSource.close();let a;if(this.envoyConfig.isEnvoy||this.baseUrl.includes("/grpc"))a=`${this.baseUrl}/tsd.TranslationService/SubscribeTranslations`;else return console.log("[TSd] SSE not available in production mode, skipping real-time updates"),()=>{this.subscriptions.delete(o)};const r=new URL(a);return t&&r.searchParams.set("locales",t.join(",")),this.eventSource=new EventSource(r.toString()),this.eventSource.onmessage=l=>{try{const v=JSON.parse(l.data);v.connected?console.log(`[TSd] ✅ Real-time updates connected via ${this.envoyConfig.isEnvoy?"Envoy":"SSE"}`):(console.log("[TSd] 📨 Translation update received:",v.key),e(v))}catch(v){console.error("[TSd] ❌ Error parsing update:",v)}},this.eventSource.onerror=l=>{console.error(`[TSd] ❌ ${this.envoyConfig.isEnvoy?"Envoy streaming":"SSE"} error:`,l)},()=>{console.log("[TSd] 🔕 Unsubscribing from real-time updates"),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.subscriptions.delete(o)}}};Lt(je,"TsdGrpcClient");let Be=je;typeof window<"u"&&(window.TsdGrpcClient=Be);var Ft=G('<span class="original-text svelte-kqb54u"> </span>'),Ht=G('<span class="translated-text svelte-kqb54u"> </span>'),Gt=G('<span class="loading-text svelte-kqb54u">...</span>'),qt=G("<span><!></span>");function C(s,e){Ae(e,!0);let t=ke(e,"native",3,"en"),o=K(""),a=K(!0),r=K(""),l=K(null),v=K(Oe({protocol:"unknown",environment:"unknown",isEnvoy:!1})),g,m=null,S=K(Oe(ye.current));yt(()=>ye.subscribe(y=>{b(S,y,!0),n(l)&&n(r)&&x()})),qe(()=>{const p=()=>{if(g&&g.firstChild){const y=g.textContent||"";b(r,y.trim(),!0),console.log("[TSd] Extracted text content:",n(r))}};return requestAnimationFrame(()=>{var y;if(p(),!window.__TSD_GRPC_CLIENT__){console.log("[TSd] Creating gRPC client");const T=new Be({host:window.location.hostname,port:50051,envoy:((y=window.__TSD_CONFIG__)==null?void 0:y.envoy)||{}});window.__TSD_GRPC_CLIENT__=T}b(l,window.__TSD_GRPC_CLIENT__,!0),console.log("[TSd] gRPC client initialized"),n(l).envoyConfig&&b(v,n(l).envoyConfig,!0),m=n(l).subscribeToUpdates(M),x()}),window.addEventListener("tsd:translations-updated",N),window.addEventListener("tsd:locale-changed",j),()=>{m&&m(),window.removeEventListener("tsd:translations-updated",N),window.removeEventListener("tsd:locale-changed",j)}});async function x(){if(!n(l)||!n(r)){console.log("[TSd] Cannot request translation:",{grpcClient:!!n(l),textContent:n(r)});return}if(console.log("[TSd] Requesting translation:",{text:n(r),native:t(),currentLocale:n(S)}),n(S)===t()){b(o,n(r),!0),b(a,!1);return}try{b(o,await n(l).translate(n(r),t(),n(S)),!0),b(a,!1)}catch(p){console.error("[TSd] Translation error:",p),b(o,n(r),!0),b(a,!1)}}function M(p){p.entry&&p.entry.text===n(r)&&p.entry.translations&&p.entry.translations[n(S)]&&b(o,p.entry.translations[n(S)],!0)}function N(p){const T=p.detail;for(const q in T)if(T[q].text===n(r)){b(o,T[q].translations[n(S)]||n(r),!0);break}}function j(){n(r)&&x()}var O=qt();let X;var z=c(O);{var oe=p=>{var y=De(),T=Ie(y);Le(T,()=>e.children),_(p,y)},B=(p,y)=>{{var T=$=>{var I=Ft(),D=c(I,!0);d(I),ne(()=>H(D,n(r))),_($,I)},q=($,I)=>{{var D=P=>{var L=Ht(),A=c(L,!0);d(L),ne(()=>H(A,n(o))),_(P,L)},Q=(P,L)=>{{var A=R=>{var W=De(),J=Ie(W);Le(J,()=>e.children),_(R,W)},Z=R=>{var W=Gt();_(R,W)};V(P,R=>{e.children?R(A):R(Z,!1)},L)}};V($,P=>{n(o)?P(D):P(Q,!1)},I)}};V(p,$=>{n(a)&&n(r)?$(T):$(q,!1)},y)}};V(z,p=>{!n(r)&&e.children?p(oe):p(B,!1)})}d(O),wt(O,p=>g=p,()=>g),ne(p=>{X=F(O,1,"tsd-translation svelte-kqb54u",null,X,p),xt(O,"title",`${n(v).isEnvoy?"Via Envoy Proxy":"Direct HTTP"} - ${n(v).environment??""}`)},[()=>({loading:n(a),translating:n(a)&&n(r)})]),_(s,O),We()}var At=G('<span class="status envoy svelte-1b3dai5">🚀 gRPC-Web via Envoy</span>'),Wt=G('<span class="status http svelte-1b3dai5">🌐 gRPC-Web over HTTP/JSON</span>'),kt=G('<div class="debug-info svelte-1b3dai5"><p>Open your browser console to see detailed translation logs including:</p> <ul class="svelte-1b3dai5"><li class="svelte-1b3dai5">🚀 Envoy proxy detection</li> <li class="svelte-1b3dai5">📤 Translation requests with timing</li> <li class="svelte-1b3dai5">📥 Translation responses</li> <li class="svelte-1b3dai5">🔔 Real-time update notifications</li> <li class="svelte-1b3dai5">⚡ Performance metrics</li></ul></div>'),Mt=G('<div class="container svelte-1b3dai5"><header class="svelte-1b3dai5"><h1 class="svelte-1b3dai5"><!></h1> <div class="connection-status svelte-1b3dai5"><!> <span class="env svelte-1b3dai5"> </span></div></header> <nav class="svelte-1b3dai5"><button>English</button> <button>Español</button> <button>Français</button> <button>Deutsch</button> <button>日本語</button> <button>中文</button></nav> <main><section class="demo-section svelte-1b3dai5"><h2><!></h2> <div class="example svelte-1b3dai5"><h3 class="svelte-1b3dai5"><!></h3> <p><!></p> <p><!></p></div> <div class="example svelte-1b3dai5"><h3 class="svelte-1b3dai5"><!></h3> <p><!></p> <p><!></p> <p><!></p> <p><!></p></div> <div class="example svelte-1b3dai5"><h3 class="svelte-1b3dai5"><!></h3> <p><!></p></div></section> <section class="info-section svelte-1b3dai5"><h2 class="svelte-1b3dai5">Current Status</h2> <ul class="svelte-1b3dai5"><li class="svelte-1b3dai5">Locale: <strong> </strong></li> <li class="svelte-1b3dai5">API: <strong>gRPC-Web Translation Service</strong></li> <li class="svelte-1b3dai5">Transport: <strong> </strong></li> <li class="svelte-1b3dai5">Environment: <strong> </strong></li> <li class="svelte-1b3dai5">Proxy: <strong> </strong></li></ul> <button class="debug-toggle svelte-1b3dai5"> </button> <!></section> <section class="info-section svelte-1b3dai5"><h2 class="svelte-1b3dai5">Architecture</h2> <div class="architecture-info svelte-1b3dai5"><p><strong>TSd uses gRPC-Web API</strong> for all translation operations:</p> <ul class="svelte-1b3dai5"><li class="svelte-1b3dai5"><code class="svelte-1b3dai5">TranslationService.Translate</code> - Get translations</li> <li class="svelte-1b3dai5"><code class="svelte-1b3dai5">TranslationService.SubscribeTranslations</code> - Real-time updates via SSE</li> <li class="svelte-1b3dai5"><code class="svelte-1b3dai5">TranslationService.GetTranslations</code> - Batch operations</li></ul> <p>In development, the gRPC-Web API is served over HTTP/JSON for easy debugging. In production with Envoy, it uses native gRPC-Web binary protocol for better performance.</p></div></section></main></div>');function on(s,e){Ae(e,!1);let t=ke(e,"data",8),o=te(t().locale),a,r=te({}),l=te(!0),v=te(!1);qe(()=>{a=ye.subscribe(u=>{b(o,u)});const i=()=>{const u=window.__TSD_GRPC_CLIENT__;u&&u.envoyConfig?b(r,u.envoyConfig):setTimeout(i,100)};i();const h=u=>{const{path:be}=u.detail;Fe(be,{replaceState:!0,noScroll:!0,keepFocus:!0})};return window.addEventListener("tsd:locale-navigate",h),()=>{window.removeEventListener("tsd:locale-navigate",h)}}),ht(()=>{a&&a()});async function g(i){if(!(n(v)||i===n(o))){b(v,!0);try{Et(i),await Fe(`/${i}/tsd-demo`,{replaceState:!0,noScroll:!0,keepFocus:!0})}finally{b(v,!1)}}}St();var m=Mt(),S=c(m),x=c(S),M=c(x);C(M,{children:(i,h)=>{w();var u=E("Welcome to TSd Demo");_(i,u)},$$slots:{default:!0}}),d(x);var N=f(x,2),j=c(N);{var O=i=>{var h=At();_(i,h)},X=i=>{var h=Wt();_(i,h)};V(j,i=>{n(r).isEnvoy?i(O):i(X,!1)})}var z=f(j,2),oe=c(z,!0);d(z),d(N),d(S);var B=f(S,2),p=c(B);let y;var T=f(p,2);let q;var $=f(T,2);let I;var D=f($,2);let Q;var P=f(D,2);let L;var A=f(P,2);let Z;d(B);var R=f(B,2);let W;var J=c(R),se=c(J),Je=c(se);C(Je,{children:(i,h)=>{w();var u=E("Translation Examples");_(i,u)},$$slots:{default:!0}}),d(se);var ie=f(se,2),re=c(ie),Xe=c(re);C(Xe,{children:(i,h)=>{w();var u=E("Simple Text");_(i,u)},$$slots:{default:!0}}),d(re);var ae=f(re,2),ze=c(ae);C(ze,{children:(i,h)=>{w();var u=E("Hello, world!");_(i,u)},$$slots:{default:!0}}),d(ae);var we=f(ae,2),Qe=c(we);C(Qe,{children:(i,h)=>{w();var u=E("This is a test of the TSd translation system.");_(i,u)},$$slots:{default:!0}}),d(we),d(ie);var le=f(ie,2),ce=c(le),Ze=c(ce);C(Ze,{children:(i,h)=>{w();var u=E("Common Phrases");_(i,u)},$$slots:{default:!0}}),d(ce);var de=f(ce,2),et=c(de);C(et,{children:(i,h)=>{w();var u=E("Welcome");_(i,u)},$$slots:{default:!0}}),d(de);var ve=f(de,2),tt=c(ve);C(tt,{children:(i,h)=>{w();var u=E("Thank you");_(i,u)},$$slots:{default:!0}}),d(ve);var ue=f(ve,2),nt=c(ue);C(nt,{children:(i,h)=>{w();var u=E("Good morning");_(i,u)},$$slots:{default:!0}}),d(ue);var Se=f(ue,2),ot=c(Se);C(ot,{children:(i,h)=>{w();var u=E("Goodbye");_(i,u)},$$slots:{default:!0}}),d(Se),d(le);var Ee=f(le,2),fe=c(Ee),st=c(fe);C(st,{children:(i,h)=>{w();var u=E("Longer Text");_(i,u)},$$slots:{default:!0}}),d(fe);var Ce=f(fe,2),it=c(Ce);C(it,{children:(i,h)=>{w();var u=E("This translation system uses just-in-time translation with caching to provide fast, efficient multilingual support for your application.");_(i,u)},$$slots:{default:!0}}),d(Ce),d(Ee),d(J);var $e=f(J,2),pe=f(c($e),2),ge=c(pe),Pe=f(c(ge)),rt=c(Pe,!0);d(Pe),d(ge);var he=f(ge,4),xe=f(c(he)),at=c(xe,!0);d(xe),d(he);var _e=f(he,2),Re=f(c(_e)),lt=c(Re,!0);d(Re),d(_e);var Ue=f(_e,2),Ne=f(c(Ue)),ct=c(Ne,!0);d(Ne),d(Ue),d(pe);var ee=f(pe,2),dt=c(ee);d(ee);var vt=f(ee,2);{var ut=i=>{var h=kt();_(i,h)};V(vt,i=>{n(l)&&i(ut)})}d($e),w(2),d(R),d(m),ne((i,h,u,be,ft,pt,gt)=>{H(oe,n(r).environment||"loading..."),p.disabled=n(v),y=F(p,1,"svelte-1b3dai5",null,y,i),T.disabled=n(v),q=F(T,1,"svelte-1b3dai5",null,q,h),$.disabled=n(v),I=F($,1,"svelte-1b3dai5",null,I,u),D.disabled=n(v),Q=F(D,1,"svelte-1b3dai5",null,Q,be),P.disabled=n(v),L=F(P,1,"svelte-1b3dai5",null,L,ft),A.disabled=n(v),Z=F(A,1,"svelte-1b3dai5",null,Z,pt),W=F(R,1,"svelte-1b3dai5",null,W,gt),H(rt,n(o)),H(at,n(r).protocol||"loading..."),H(lt,n(r).environment||"loading..."),H(ct,n(r).isEnvoy?"Envoy":"Direct HTTP"),H(dt,`${n(l)?"Hide":"Show"} Console Logs`)},[()=>({active:n(o)==="en"}),()=>({active:n(o)==="es"}),()=>({active:n(o)==="fr"}),()=>({active:n(o)==="de"}),()=>({active:n(o)==="ja"}),()=>({active:n(o)==="zh"}),()=>({loading:n(v)})],Tt),k("click",p,()=>g("en")),k("click",T,()=>g("es")),k("click",$,()=>g("fr")),k("click",D,()=>g("de")),k("click",P,()=>g("ja")),k("click",A,()=>g("zh")),k("click",ee,()=>b(l,!n(l))),_(s,m),We()}export{on as component};
